<!doctype html>
<html>
	<head>
		<title>
			Decoder
		</title>
		<base target="_blank">
		<script src="https://epicenterprograms.github.io/standards/behavior/general.js"></script>
		<script>
			var S = Standards.general;

			var telegraph = new S.Sound({ waveform: "square" });
			S.listen("morseCodeText", "dblclick", function () {
				this.value = "";
			});
			S.listen("morseCodeText", "keydown", function (event) {
				if (event.key == "Enter") {
					toMorseCode();
				}
			});
			function toMorseCode() {
				if (S.getId("morseCodeText").value.trim() != "") {
					let translation = "";
					let note = "a";
					S.getId("morseCodeText").value.toLowerCase().split("").forEach(function (character) {
						switch (character) {
							case "a":
								translation += ". -";
								break;
							case "b":
								translation += "- . . .";
								break;
							case "c":
								translation += "- . - .";
								break;
							case "d":
								translation += "- . .";
								break;
							case "e":
								translation += ".";
								break;
							case "f":
								translation += ". . - .";
								break;
							case "g":
								translation += "- - .";
								break;
							case "h":
								translation += ". . . .";
								break;
							case "i":
								translation += ". .";
								break;
							case "j":
								translation += ". - - -";
								break;
							case "k":
								translation += "- . -";
								break;
							case "l":
								translation += ". - . .";
								break;
							case "m":
								translation += "- -";
								break;
							case "n":
								translation += "- .";
								break;
							case "o":
								translation += "- - -";
								break;
							case "p":
								translation += ". - - .";
								break;
							case "q":
								translation += "- - . -";
								break;
							case "r":
								translation += ". - .";
								break;
							case "s":
								translation += ". . .";
								break;
							case "t":
								translation += "-";
								break;
							case "u":
								translation += ". . -";
								break;
							case "v":
								translation += ". . . -";
								break;
							case "w":
								translation += ". - -";
								break;
							case "x":
								translation += "- . . -";
								break;
							case "y":
								translation += "- . - -";
								break;
							case "z":
								translation += "- - . .";
								break;
							case " ":
								translation += "    ";
								break;
							case "0":
								translation += "- - - - -";
								break;
							case "1":
								translation += ". - - - -";
								break;
							case "2":
								translation += ". . - - -";
								break;
							case "3":
								translation += ". . . - -";
								break;
							case "4":
								translation += ". . . . -";
								break;
							case "5":
								translation += ". . . . .";
								break;
							case "6":
								translation += "- . . . .";
								break;
							case "7":
								translation += "- - . . .";
								break;
							case "8":
								translation += "- - - . .";
								break;
							case "9":
								translation += "- - - - .";
								break;
							case ".":
								translation += ". - . - . -";
								break;
							case "?":
								translation += ". . - - . .";
								break;
							case "!":
								translation += ["- . - . - -", "- - - ."][Math.round(Math.random())];
								break;
							case ",":
								translation += "- - . . - -";
								break;
							case "'":
								translation += ". - - - - .";
								break;
							case "(":
								translation += "- . - - .";
								break;
							case ")":
								translation += "- . - - . -";
								break;
							case ":":
								translation += "- - - . . .";
								break;
							case ";":
								translation += "- . - . - .";
								break;
							case '"':
								translation += ". - . . - .";
								break;
							case "/":
								translation += "- . . - .";
								break;
							case "+":
								translation += ". - . - .";
								break;
							case "-":
								translation += "- . . . . -";
								break;
							case "=":
								translation += "- . . . -";
								break;
							case "$":
								translation += ". . . - . . -";
								break;
							case "@":
								translation += ". - - . - .";
								break;
							case "_":
								translation += ". . - - . -";
								break;
							case "ñ":
								translation += "- - . - -";
								break;
							default:
								translation += "*";
						}
						translation += "   ";
					});
					translation = translation.replace(/\./g, note).trim();
					translation = translation.replace(/-/g, note + "--");
					translation = translation.replace(/\*/g, "a5-");
					telegraph.play(translation, { attack: 1, noteLength: 1000/S.getId("morseCodeSpeed").value, decay: 1 });
				}
			}
			S.listen("morseCodeSpeed", "dblclick", function () {
				this.value = "";
			});
			S.listen("morseCodeSpeed", "change", function () {
				this.value = this.value.trim();
				if (this.value == "" || S.getType(Number(this.value)) != "Number" || Number(this.value) < 1) {
					this.value = 15;
				}
			});
			S.listen("randomMorseCode", "click", function () {
				if (!telegraph.playing) {
					let text = S.getId("morseCodeText");
					text.value = "";
					text.value += ["I am ", "You are ", "We are ", "Morse Code is ", "This website is "][Math.floor(Math.random() * 5)];
					text.value += ["super ", "extremely ", "very ", "unmistakably ", "indisputably ", "most certainly ", "absolutely ", "without question ", "exceptionally "][Math.floor(Math.random() * 9)];
					text.value += ["amazing.", "awesome.", "cool.", "spectacular.", "sublime.", "lame. (Just kidding.)"][Math.floor(Math.random() * 6)];
					toMorseCode();
					text.value = "";
				}
			});

			S.listen("decrypted", "dblclick", function () {
				this.value = "";
				S.getId("encrypted").value = "";
			});
			S.listen("encrypted", "dblclick", function () {
				this.value = "";
				S.getId("decrypted").value = "";
			});
			S.listen("encode", "click", function () {
				let alphabet = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];
				let ALPHABET = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];
				if (S.getId("decrypted").value.trim() != "") {
					S.getId("encrypted").value = S.getId("decrypted").value.trim().replace(/\w|(?: \w)/g, function (match) {
						if (match[0] == " ") {
							if (alphabet.includes(match[1])) {
								match = String(2 * (alphabet.indexOf(match[1]) + 1));
								if (match.length < 2) {
									match = "0" + match;
								}
								match = match.splice(0, 1, match[0] == "0" ? "j" : alphabet[Number(match[0])-1]);
								match = match.splice(1, 1, match[1] == "0" ? "J" : ALPHABET[Number(match[1])-1]);
							} else if (ALPHABET.includes(match[1])) {
								match = String(2 * (ALPHABET.indexOf(match[1]) + 1));
								if (match.length < 2) {
									match = "0" + match;
								}
								match = match.splice(0, 1, match[0] == "0" ? "J" : ALPHABET[Number(match[0])-1]);
								match = match.splice(1, 1, match[1] == "0" ? "J" : ALPHABET[Number(match[1])-1]);
							}
						} else if (alphabet.includes(match)) {
							match = String(alphabet.indexOf(match) + 1);
							if (match.length < 2) {
								match = "0" + match;
							}
							match = match.splice(0, 1, match[0] == "0" ? "j" : alphabet[Number(match[0])-1]);
							match = match.splice(1, 1, match[1] == "0" ? "j" : alphabet[Number(match[1])-1]);
						} else if (ALPHABET.includes(match)) {
							match = String(ALPHABET.indexOf(match) + 1);
							if (match.length < 2) {
								match = "0" + match;
							}
							match = match.splice(0, 1, match[0] == "0" ? "J" : ALPHABET[Number(match[0])-1]);
							match = match.splice(1, 1, match[1] == "0" ? "j" : alphabet[Number(match[1])-1]);
						}
						return match;
					});
				} else if (S.getId("encrypted").value.trim() != "") {
					S.getId("decrypted").value = S.getId("encrypted").value.trim().replace(/\w\w/g, function (match) {
						if (alphabet.includes(match[0])) {  // not a capital
							if (alphabet.includes(match[1])) {  // not preceded by a space
								match = match.splice(0, 1, match[0] == "j" ? "0" : String(alphabet.indexOf(match[0]) + 1));
								match = match.splice(1, 1, match[1] == "j" ? "0" : String(alphabet.indexOf(match[1]) + 1));
								match = alphabet[Number(match) - 1];
							} else if (ALPHABET.includes(match[1])) {  // preceded by a space
								match = match.splice(0, 1, match[0] == "j" ? "0" : String(alphabet.indexOf(match[0]) + 1));
								match = match.splice(1, 1, match[1] == "J" ? "0" : String(ALPHABET.indexOf(match[1]) + 1));
								match = " " + alphabet[Number(match) / 2 - 1];
							}
						} else if (ALPHABET.includes(match[0])) {  // a capital
							if (alphabet.includes(match[1])) {  // not preceded by a space
								match = match.splice(0, 1, match[0] == "J" ? "0" : String(ALPHABET.indexOf(match[0]) + 1));
								match = match.splice(1, 1, match[1] == "j" ? "0" : String(alphabet.indexOf(match[1]) + 1));
								match = ALPHABET[Number(match) - 1];
							} else if (ALPHABET.includes(match[1])) {  // preceded by a space
								match = match.splice(0, 1, match[0] == "J" ? "0" : String(ALPHABET.indexOf(match[0]) + 1));
								match = match.splice(1, 1, match[1] == "J" ? "0" : String(ALPHABET.indexOf(match[1]) + 1));
								match = " " + ALPHABET[Number(match) / 2 - 1];
							}
						}
						return match;
					});
				}
			});

			S.onKeyDown("Enter", function () {
				switch (document.activeElement) {
					case S.getId("morseCodeText"):
						toMorseCode();
						break;
					case S.getId("decrypted"):
						S.getId("encode").click();
						break;
					case S.getId("encrypted"):
						S.getId("encode").click();
						break;
				}
			});

			S.onLoad(function () {
				S.makeToneGenerator(true);
			});
		</script>
		<link rel="stylesheet" href="https://epicenterprograms.github.io/standards/formatting/foundation.css">
		<style>
			#morseCodeSpeed {
				width: 2rem;
			}
		</style>
	</head>
	<body>
		<h1 class="main-title">
			Extras
		</h1>
		<main>
			<button onclick='window.location.href = "."'>
				Back
			</button>
			<br>
			<h2>
				Morse Code
			</h2>
			<input type="text" id="morseCodeText">
			<button onclick="toMorseCode()">
				Translate to Morse Code
			</button>
			Speed:
			<input type="text" id="morseCodeSpeed" value="15">
			<br>
			<button id="randomMorseCode">
				Make a random message in Morse Code
			</button>
			<h2>
				Code generator
			</h2>
			<input type="text" id="decrypted" placeholder="Encode">
			<button id="encode">
				Encode
			</button>
			<input type="text" id="encrypted" placeholder="Decode">
		</main>
	</body>
</html>
