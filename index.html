<!DOCTYPE html>
<html>
    <head>
        <title>
            Decoder
        </title>
        <script>
            var words = [[]];
            window.addEventListener("load", function() {
                // sets "words" to a list of English words
                var file = new XMLHttpRequest();
                file.open("GET", "word list.txt");
                file.onreadystatechange = function () {
                    if(file.readyState === 4) {
                        if(file.status === 200 || file.status == 0) {
                            var wordList = file.responseText;  // sets words to a single string of the whole file
                            wordList = wordList.split(/\r\n|\n/);  // sets words to an array of lines of text
                            wordList.pop();  // For some reason, there's an empty item at the end of the list that I need to get rid of.
                            for (var word in wordList) {
                                word = wordList[word];
                                while (word.length > words.length) {
                                    words.push([]);
                                }
                                words[word.length-1].push(word);
                            }
                        }
                    }
                }
                file.send();
                // gives the decode button functionality
                document.getElementById("decode").addEventListener("click", function() {
                    document.getElementById("before").style.display = "none";
                    document.getElementById("during").style.display = "block";
                    setTimeout(decode, 0);
                });
                // gives the newCode button functionality
                document.getElementById("newCode").addEventListener("click", function() {
                    document.getElementById("after").style.display = "none";
                    document.getElementById("before").style.display = "block";
                });
            });
            function decode() {
                var codeText = document.getElementById("code").value.toLowerCase().split(" ");
                var solution = document.getElementById("solution").value;
                // var progress = document.getElementById("progress").style.width;
                for (var text in codeText) {
                    text = codeText[text];
                    for (var word in words[text.length-1]) {
                        word = words[text.length-1][word];
                        solution += word + " ";
                    }
                    solution += "\n\n";
                    setTimeout(function() {
                        document.getElementById("progress").style.width = (codeText.indexOf(text)+1)/codeText.length*100 + "%";
                        alert((codeText.indexOf(text)+1)/codeText.length*100+"%\n\n"+(codeText.indexOf(text)+1)+"\n\n"+codeText.length);
                    }, 0);
                    for (var word in words) {
                    }
                }
                document.getElementById("solution").value = solution;
                document.getElementById("during").style.display = "none";
                document.getElementById("progress").style.width = "0%";
                document.getElementById("after").style.display = "block";
            }
        </script>
        <style>
            body {
                text-align: center;
            }
            div {
                margin: auto;
            }
            #during {
                display: none;
            }
            #progress {
                width: 0%;
                height: 100%;
                background: #00e;
            }
            #after {
                display: none;
            }
        </style>
    </head>
    <body>
        <h1>
            Decoder
        </h1>
        <p>
            Trial number = 50
        </p>
        <div id="before">
            <textarea cols="60" rows="10" placeholder="Type the code here." id="code"></textarea>
            <br>
            <br>
            <button type="button" id="decode">
                Decode
            </button>
        </div>
        <div id="during">
            <h3>
                Working...
            </h3>
            <div style="width:30em; height:1em; background:#fff; border:.1em solid black;">
            <div id="progress">
            </div>
            </div>
        </div>
        <div id="after">
            <textarea cols="60" rows="10" id="solution"></textarea>
            <p id="solutionNumber"></p>
            <button type="button" id="newCode">
                Try a new<br>
                code
            </button>
        </div>
    </body>
</html>
