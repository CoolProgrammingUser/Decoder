<!doctype html>
<html class="cursor">
	<head>
		<title>
			Decoder
		</title>
		<script src="https://epicenterprograms.github.io/standards/behavior/general.js"></script>
		<!--
		<script src="file:///C:/Users/Robert/Documents/GitHub/standards/behavior/general.js"></script>
		-->
		<script>
			var S = Standards.general;
			
			var worker = new Worker("brain.js");

			// https://www.worldclasslearning.com/english/five-verb-forms.html
			var words = [[]];  // holds every English word in arrays in order of increasing word length
			var verbs = [[]];  // holds every verb in arrays in order of increasing word length
			var solutions = [];  // holds all possible solutions
			var filtered = {};
			var hidden = [];
			var solutionIndex = 0;  // holds which solution is to be displayed

			window.addEventListener("finished", function() {

				// sets "words" to a list of English words
				S.getFile("word list.txt", function (wordList) {
					wordList = wordList.trim().split(/\r\n|\n/);  // sets words to an array of lines of text
					wordList.pop();  // For some reason, there's an empty item at the end of the list that I need to get rid of.
					//////////
					// This isn't necessary if I modify the lists.
					var remove = ['b', 'c', 'd', 'e', 'f', 'g', 'h', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'aa', 'ab', 'ac', 'ah', 'aj', 'al', 'au', 'av', 'aw', 'ba', 'bb', 'bc', 'bd', 'bg', 'bi', 'bk', 'bl', 'bm', 'bo', 'bp', 'br', 'bs', 'bt', 'bw', 'ca', 'cc', 'cb', 'ce', 'cf', 'cg', 'ch', 'ci', 'cj', 'cl', 'cm', 'cn', 'co', 'cp', 'cr', 'cs', 'ct', 'cu', 'cv', 'cw', 'cz', 'da', 'db', 'dc', 'dd', 'de', 'df', 'dg', 'dh', 'di', 'dk', 'dl', 'dm', 'dp', 'dr', 'ds', 'dt', 'du', 'dv', 'dx', 'ea', 'ec', 'ed', 'ee', 'ef', 'eg', 'eh', 'el', 'em', 'en', 'ep', 'eq', 'er', 'es', 'et', 'eu', 'ev', 'ex', 'ez', 'fa', 'fc', 'fd', 'fe', 'ff', 'fg', 'fi', 'fl', 'fm', 'fo', 'fp', 'fr', 'fs', 'ft', 'fu', 'fw', 'fx', 'fy', 'ga', 'gb', 'gc', 'gd', 'ge', 'gg', 'gi', 'gl', 'gm', 'gp', 'gr', 'gs', 'gt', 'ha', 'hb', 'hc', 'hd', 'hh', 'hk', 'hl', 'ho', 'hp', 'hq', 'hr', 'hs', 'ht', 'hu', 'hz', 'ia', 'ic', 'ie', 'ii', 'il', 'im', 'io', 'ip', 'ir', 'iv', 'ix', 'ja', 'jc', 'jd', 'je', 'jj', 'jm', 'jo', 'jp', 'jr', 'js', 'ka', 'kb', 'kg', 'km', 'ko', 'ks', 'kw', 'ky', 'la', 'lb', 'lc', 'ld', 'le', 'lf', 'lg', 'li', 'll', 'lm', 'ln', 'lo', 'lp', 'ls', 'lt', 'lu', 'ma', 'mb', 'mc', 'md', 'mf', 'mg', 'mh', 'mi', 'mj', 'ml', 'mm', 'mn', 'mo', 'mp', 'mr', 'mrs', 'ms', 'mt', 'mu', 'mv', 'mw', 'mx', 'na', 'nb', 'nc', 'nd', 'ne', 'ng', 'nh', 'ni', 'nj', 'nl', 'nm', 'nn', 'np', 'nr', 'ns', 'nt', 'nu', 'nv', 'nw', 'ny', 'nz', 'ob', 'oc', 'oe', 'og', 'oh', 'ol', 'om', 'oo', 'op', 'os', 'ot', 'ou', 'oz', 'pa', 'pb', 'pc', 'pd', 'pe', 'pf', 'pg', 'ph', 'pj', 'pk', 'pl', 'pn', 'po', 'pp', 'pr', 'ps', 'pt', 'qc', 'qt', 'ra', 'rb', 'rc', 'rd', 're', 'rf', 'rg', 'rh', 'ri', 'rj', 'rl', 'rm', 'rn', 'ro', 'rp', 'rr', 'rs', 'rt', 'ru', 'rv', 'rw', 'rx', 'sa', 'sb', 'sc', 'sd', 'se', 'sf', 'sg', 'sh', 'si', 'sk', 'sl', 'sm', 'sn', 'sp', 'sq', 'sr', 'ss', 'st', 'su', 'sv', 'sw', 'ta', 'tb', 'tc', 'td', 'te', 'tf', 'th', 'ti', 'tm', 'tn', 'tp', 'tr', 'ts', 'tt', 'tu', 'tx', 'ty', 'uc', 'uh', 'ui', 'uk', 'ul', 'um', 'un', 'ur', 'ut', 'uv', 'uw', 'va', 'vb', 'vc', 've', 'vg', 'vi', 'vp', 'vs', 'vt', 'wa', 'wb', 'wc', 'wi', 'wm', 'wn', 'wp', 'wr', 'ws', 'wt', 'wu', 'wv', 'ww', 'wx', 'wy', 'xi', 'xl', 'xp', 'xx', 'ya', 'ye', 'yn', 'yo', 'yr', 'yu', 'za', 'zu', 'aaa', 'abc', 'abu', 'acc', 'acm', 'ada', 'adsl', 'ae', 'af', 'ag', 'ai', 'ak', 'ala', 'ali', 'alot', 'alt', 'amazoncom', 'amazoncouk', 'amd', 'amy', 'aol', 'ap', 'api', 'apr', 'ar', 'arg', 'asn', 'asp', 'ata', 'ati', 'aud', 'aug', 'aus', 'ave', 'avg', 'avi', 'aye', 'az', 'ann', 'cnn', 'css', 'dee', 'fcc', 'fee', 'foo', 'gcc', 'lee', 'rss', 'vii', 'bbc', 'bbs', 'bbw', 'ccd', 'ddr', 'llc', 'llp', 'ppc', 'ppm', 'rrp', 'ssl', 'aka', 'ana', 'bob', 'dod', 'dvd', 'gig', 'lil', 'lol', 'mem', 'non', 'pgp', 'php', 'psp', 'sas', 'sms', 'sys', 'tft', 'ben', 'bio', 'bios', 'biz', 'blvd', 'bmw', 'boc', 'bon', 'buf', 'cad', 'cal', 'cam', 'cams', 'cas', 'cbs', 'cds', 'cdt', 'ceo', 'cest', 'cet', 'cfr', 'cgi', 'chad', 'chi', 'cho', 'cia', 'ciao', 'cio', 'cir', 'cms', 'col', 'com', 'cos', 'cox', 'cpu', 'crm', 'cst', 'cum', 'cvs', 'dan', 'das', 'dat', 'dec', 'def', 'del', 'dem', 'der', 'des', 'dev', 'die', 'dir', 'dis', 'div', 'diy', 'dna', 'dns', 'doc', 'dom', 'dos', 'dow', 'dpi', 'dsc', 'dsl', 'dts', 'dui', 'eau', 'eco', 'eds', 'edt', 'enb', 'eng', 'ent', 'eos', 'epa', 'erp', 'est', 'etc', 'eur', 'eva', 'exp', 'ext', 'faq', 'fbi', 'fda', 'feb', 'fla', 'fri', 'ftp', 'fwd', 'gba', 'gbp', 'gdp', 'gen', 'geo', 'ghz', 'gif', 'gis', 'gmc', 'gmt', 'gnu', 'gov', 'gpl', 'gps', 'gsm', 'gst', 'gtk', 'gui', 'hart', 'hiv', 'hon', 'hrs', 'hwy', 'ian', 'ibm', 'icq', 'ict', 'ide', 'iii', 'ima', 'img', 'inc', 'ind', 'inf', 'ing', 'ins', 'int', 'ips', 'ira', 'irc', 'irs', 'isa', 'iso', 'isp', 'ist', 'jan', 'jim', 'joe', 'jon', 'jpg', 'jul', 'jun', 'jvc', 'kai', 'kay', 'kde', 'ken', 'kim', 'lan', 'las', 'lat', 'lbs', 'lcd', 'len', 'leo', 'les', 'leu', 'lib', 'liz', 'loc', 'los', 'lou', 'ltd', 'mae', 'mag', 'mai', 'mar', 'mas', 'mba', 'med', 'mel', 'mfg', 'mhz', 'mia', 'mic', 'mid', 'mil', 'min', 'mlb', 'mls', 'mod', 'mon', 'mpg', 'mph', 'msg', 'msn', 'mtv', 'nam', 'nat', 'nav', 'nba', 'nbc', 'nec', 'neo', 'nfl', 'nhl', 'nhs', 'nil', 'nor', 'nos', 'nov', 'nsw', 'nyc', 'obj', 'oct', 'oem', 'ons', 'ooo', 'org', 'pac', 'pal', 'pam', 'pas', 'pci', 'pcs', 'pct', 'pda', 'pdf', 'pdt', 'phd', 'phi', 'phys', 'pic', 'pix', 'plc', 'pmc', 'por', 'pos', 'pre', 'psi', 'pst', 'pts', 'pty', 'pvc', 'qld', 'qty', 'que', 'qui', 'rca', 'rec', 'ref', 'reg', 'reid', 'rel', 'rep', 'res', 'rfc', 'rna', 'rob', 'rom', 'ron', 'roy', 'rpg', 'rpm', 'sam', 'san', 'sao', 'sci', 'sec', 'sen', 'seo', 'sep', 'seq', 'ser', 'sic', 'sie', 'sig', 'sim', 'sku', 'soa', 'soc', 'sol', 'sox', 'sql', 'src', 'sri', 'std', 'ste', 'str', 'sur', 'tba', 'tcp', 'ted', 'tel', 'tex', 'tgp', 'thu', 'thy', 'til', 'tim', 'tmp', 'tom', 'tri', 'tue', 'una', 'und', 'une', 'uni', 'upc', 'ups', 'uri', 'url', 'urw', 'usb', 'usc', 'usd', 'usr', 'utc', 'val', 'var', 'vcr', 'ver', 'vhs', 'vic', 'vid', 'vip', 'vol', 'von', 'vpn', 'wal', 'wan', 'wav', 'wed', 'wma', 'wto', 'xml', 'xxx', 'yea', 'yrs', 'zum', 'zus'];
					remove.forEach(function (word) {
						wordList.splice(wordList.indexOf(word), 1);
					});
					var add = ['aardvark', 'amps', 'armadillo', 'auger', 'bites', 'cuttlefish', 'eel', 'encode', 'encoded', 'encodes', 'foe', 'kangaroo', 'lizard', 'octopus', 'parrot', 'squid'];
					add.forEach(function (word) {
						wordList.push(word);
					});
					wordList.sort();  // alphabetizes wordList
					//////////
					wordList.forEach(function (word) {
						while (word.length > words.length) {
							words.push([]);
						}
						words[word.length - 1].push(word);
					});
					console.log(words);
				}).catch(function (error) {
					S.makeDialog("The word list wasn't loaded.");
					console.error("The word list wasn't loaded.");
					console.error(error);
				});

				// sets "verbs" to a list of verbs
				S.getFile("verbs.txt", function (list) {
					list.trim().split(/\r\n|\n| /).forEach(function (verb) {
						while (verb.length > verbs.length) {
							verbs.push([]);
						}
						verbs[verb.length - 1].push(verb);
					});
				}).catch(function (error) {
					S.makeDialog("The verb list wasn't loaded.");
					console.error("The verb list wasn't loaded.");
					console.error(error);
				});

				// gives the decode button functionality
				document.getElementById("decode").addEventListener("click", function() {
					if (S.getId("code").value != "") {
						var styles = document.styleSheets[1].cssRules || document.styleSheets[1].rules;
						S.forEach(styles, function(style) {
							if (style.selectorText == ".cursor") {
								style.style.cursor = "progress";
								return "break";
							}
						});
						document.getElementById("before").style.display = "none";
						document.getElementById("during").style.display = "block";
						decode();
					}
				});
				// gives the "superFastLast" button functionality
				S.getId("superFastLast").addEventListener("click", function() {
					if (solutionIndex > 999) {
						solutionIndex -= 1000;
					} else {
						solutionIndex = solutions.length - 1;
					}
					navigate();
				});
				// gives the "fastLast" button functionality
				S.getId("fastLast").addEventListener("click", function() {
					if (solutionIndex > 49) {
						solutionIndex -= 50;
					} else {
						solutionIndex = solutions.length - 1;
					}
					navigate();
				});
				// gives the "last" button functionality
				S.getId("last").addEventListener("click", function() {
					if (solutionIndex > 0) {
						solutionIndex--;
					} else {
						solutionIndex = solutions.length - 1;
					}
					navigate();
				});
				// gives the "next" button functionality
				S.getId("next").addEventListener("click", function() {
					if (solutionIndex < solutions.length - 1) {
						solutionIndex++;
					} else {
						solutionIndex = 0;
					}
					navigate();
				});
				// gives the "fastNext" button functionality
				S.getId("fastNext").addEventListener("click", function() {
					if (solutionIndex < solutions.length - 50) {
						solutionIndex += 50;
					} else {
						solutionIndex = 0;
					}
					navigate();
				});
				// gives the "superFastNext" button functionality
				S.getId("superFastNext").addEventListener("click", function() {
					if (solutionIndex < solutions.length - 1000) {
						solutionIndex += 1000;
					} else {
						solutionIndex = 0;
					}
					navigate();
				});
				// gives the "jump" button functionality
				S.getId("jump").addEventListener("click", function() {
					solutionIndex = S.getId("jumpIndex").value - 1;
					S.getId("jumpIndex").value = "";
					navigate();
				});
				// gives the findLast button functionality
				S.getId("findLast").addEventListener("click", function() {
					var startingIndex = solutionIndex;
					var searchText = S.getId("searchText").value;
					do {
						if (solutionIndex > 0) {
							solutionIndex--;
						} else {
							solutionIndex = solutions.length - 1;
						}
					} while (!solutions[solutionIndex].includes(searchText) && solutionIndex != startingIndex);
					if (solutionIndex == startingIndex) {
						alert("Your search text isn't present in any solution.");
					} else {
						navigate();
					}
				});
				// gives the findNext button functionality
				S.getId("findNext").addEventListener("click", function() {
					var startingIndex = solutionIndex;
					var searchText = S.getId("searchText").value;
					do {
						if (solutionIndex < solutions.length - 1) {
							solutionIndex++;
						} else {
							solutionIndex = 0;
						}
					} while (!solutions[solutionIndex].includes(searchText) && solutionIndex != startingIndex);
					if (solutionIndex == startingIndex) {
						alert("Your search text isn't present in any solution.");
					} else {
						navigate();
					}
				});
				// gives the lastWord button functionality
				S.getId("lastWord").addEventListener("click", function() {
					if (isNaN(S.getId("wordIndex").value) || S.getId("wordIndex").value < 1) {
						S.getId("wordIndex").value = 1;
					} else if (S.getId("wordIndex").value > S.getId("solution").value.split(" ").length) {
						S.getId("wordIndex").value = S.getId("solution").value.split(" ").length
					}
					var index = Number(S.getId("wordIndex").value) - 1;
					var startingIndex = solutionIndex;
					var word = S.getId("solution").value.split(" ")[index];
					do {
						if (solutionIndex > 0) {
							solutionIndex--;
						} else {
							solutionIndex = solutions.length - 1;
						}
					} while (solutions[solutionIndex].split(" ")[index] == word && solutionIndex != startingIndex);
					if (solutionIndex == startingIndex) {
						alert("There's only one word which fits at that place in these solutions.");
					} else {
						navigate();
					}
				});
				// gives the nextWord button functionality
				S.getId("nextWord").addEventListener("click", function() {
					if (isNaN(S.getId("wordIndex").value) || S.getId("wordIndex").value < 1) {
						S.getId("wordIndex").value = 1;
					} else if (S.getId("wordIndex").value > S.getId("solution").value.split(" ").length) {
						S.getId("wordIndex").value = S.getId("solution").value.split(" ").length
					}
					var index = Number(S.getId("wordIndex").value) - 1;
					var startingIndex = solutionIndex;
					var word = S.getId("solution").value.split(" ")[index];
					do {
						if (solutionIndex < solutions.length - 1) {
							solutionIndex++;
						} else {
							solutionIndex = 0;
						}
					} while (solutions[solutionIndex].split(" ")[index] == word && solutionIndex != startingIndex);
					if (solutionIndex == startingIndex) {
						alert("There's only one word which fits at the beginning of these solutions.");
					} else {
						navigate();
					}
				});
				// gives the newCode button functionality
				document.getElementById("newCode").addEventListener("click", function() {
					document.getElementById("after").style.display = "none";
					solutions = [];
					document.getElementById("code").value = "";
					document.getElementById("before").style.display = "block";
					document.getElementById("solution").value = "";
				});
			});
			function navigate() {
				S.getId("solution").value = solutions[solutionIndex];
				S.getId("solutionNumber").innerHTML = solutionIndex+1 + "/" + solutions.length;
			}


			function decode() {
				let messenger = {};
				worker.addEventListener("message", function (message) {
					if (message.data.error) {
						document.getElementById("during").style.display = "none";
						document.getElementById("before").style.display = "block";
						let styles = document.styleSheets[1].cssRules || document.styleSheets[1].rules;
						S.forEach(styles, function (style) {
							if (style.selectorText == ".cursor") {
								style.style.cursor = "auto";
								return "break";
							}
						});
						S.makeDialog("The decoder encountered a problem.");
					} else if (message.data.progress < 100) {
						S.getId("progressBar").style.width = message.data.progress + "%";
					} else {
						S.getId("progressBar").style.width = message.data.progress + "%";
						solutions = message.data.solutions;
						if (solutions.length > 0) {
							document.getElementById("solution").value = solutions[0];
							S.getId("solutionNumber").textContent = "1/" + solutions.length;
						} else {
							document.getElementById("solution").value = "No solution was found.";
							S.getId("solutionNumber").textContent = "0/0";
						}
						console.info("Time to decode = " + message.data.time + " seconds");
						document.getElementById("during").style.display = "none";
						document.getElementById("after").style.display = "block";
						let styles = document.styleSheets[1].cssRules || document.styleSheets[1].rules;
						S.forEach(styles, function (style) {
							if (style.selectorText == ".cursor") {
								style.style.cursor = "auto";
								return "break";
							}
						});
						S.getId("progressBar").style.width = "0%";
						worker.removeEventListener("message", arguments.callee);
					}
				});
				console.log(words);
				messenger.words = words;
				messenger.verbs = verbs;
				messenger.text = document.getElementById("code").value.toLowerCase();
				worker.postMessage(messenger);
			}
		</script>
		<link rel="stylesheet" href="https://epicenterprograms.github.io/standards/formatting/foundation.css">
		<!--
		<link rel="stylesheet" href="file:///C:/Users/Robert/Documents/GitHub/standards/formatting/foundation.css">
		-->
		<style>
			.cursor {
				cursor: auto;
			}
			#during {
				display: none;
			}
			#progressContainer {
				z-index: 1;
				border: .05rem solid black;
				border-radius: .25rem;
				width: 30rem;
				height: 1rem;
				background: #aaa;
			}
			#progressBar {
				z-index: -1;
				float: left;
				border-radius: .25rem;
				width: 0%;
				height: 100%;
				background: #00e;
			}
			#after {
				display: none;
			}
		</style>
	</head>
	<body>
		<h1 class="main-title">
			Decoder
		</h1>
		<main>
			<br>
			<div id="before">
				<button onclick='window.location.href = "extras"'>
					Explore extras
				</button>
				<br>
				<br>
				<textarea cols="60" rows="10" placeholder="Type the code here." id="code"></textarea>
				<br>
				<br>
				<input type="text" placeholder="Exrta words to consider" id="extraWords" disabled>
				<note-><div><div>Put in extra words you want to be considered separated by spaces. Possibilities include proper names and slang.</div></div></note->
				<br>
				<br>
				<input typer="text" placeholder="Words to filter out" id="filter1" disabled>
				<br>
				<br>
				<button type="button" id="decode">
					Decode
				</button>
			</div>
			<div id="during">
				<h3 id="workingHeading">
					Working...
				</h3>
				<div id="progressContainer">
					<div id="progressBar"></div>
				</div>
				<!-- <progress id="progress"></progress> -->
			</div>
			<div id="after">
				<textarea cols="60" rows="10" id="solution" readonly></textarea>
				<br>
				<br>
				<button id="superFastLast">
					&lt;&lt;&lt;
				</button>
				<button id="fastLast">
					&lt;&lt;
				</button>
				<button id="last">
					&lt;
				</button>
				<span id="solutionNumber">0/0</span>
				<button id="next">
					&gt;
				</button>
				<button id="fastNext">
					&gt;&gt;
				</button>
				<button id="superFastNext">
					&gt;&gt;&gt;
				</button>
				<br>
				<br>
				<input type="text" placeholder="Jump to item #:" id="jumpIndex">
				<button id="jump">
					Jump
				</button>
				<br>
				<br>
				<button id="findLast">
					&lt;
				</button>
				<input type="text" placeholder="Go to occurance of:" id="searchText">
				<button id="findNext">
					&gt;
				</button>
				<br>
				<br>
				<button id="lastWord">
					&lt; Previous word
				</button>
				<input type="text" placeholder="Word #" style="width:5em" id="wordIndex">
				<button id="nextWord">
					Next word &gt;
				</button>
				<div style="display:none">
					<br>
					<br>
					<input type="text" placeholder="Word to filter">
					<button id="filter2">
						Filter
					</button>
					<select id="filteredWords">
						<option value="" selected>
							Filtered words
						</option>
					</select>
					<button id="unfilter">
						Unfilter
					</button>
					<button id="unfilterAll">
						Unfilter all
					</button>
				</div>
				<br>
				<br>
				<button type="button" id="newCode">
					Try a new<br>
					code
				</button>
			</div>
		</main>
	</body>
</html>
